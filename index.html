<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study-Start Pro</title>
    <link rel="icon" href="mini lgo.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        /* (Zelfde CSS als voorheen, geen wijzigingen nodig voor de functionaliteit, 
            maar ik heb de navigatie cards iets mooier gemaakt voor de lijst) */
        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --primary-bg: #eff6ff;
            --bg-body: #f8fafc;
            --bg-card: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --sidebar-width: 250px;
            --radius: 8px;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; margin: 0; background-color: var(--bg-body); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; font-size: 13.5px; }
        
        /* Sidebar & Layout */
        #app-sidebar { width: var(--sidebar-width); background: var(--bg-card); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px 15px; flex-shrink: 0; transition: margin-left 0.3s ease; z-index: 50; }
        #app-sidebar.closed { margin-left: calc(var(--sidebar-width) * -1); }
        .sidebar-header { font-size: 1.1em; font-weight: 700; color: var(--primary); margin-bottom: 30px; padding: 0 10px; cursor: pointer; }
        .nav-item { padding: 10px 12px; margin-bottom: 4px; border-radius: var(--radius); color: var(--text-muted); font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: 0.15s; }
        .nav-item:hover, .nav-item.active { background-color: var(--primary-bg); color: var(--primary); font-weight: 600; }
        #main-content { flex-grow: 1; display: flex; flex-direction: column; overflow-y: auto; position: relative; }
        header { background: rgba(255,255,255,0.9); backdrop-filter: blur(5px); padding: 10px 30px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 40; border-bottom: 1px solid var(--border); height: 55px; }
        
        /* UI Elements */
        .card { background: var(--bg-card); border-radius: var(--radius); padding: 20px; margin-bottom: 20px; box-shadow: var(--shadow); border: 1px solid var(--border); }
        button { background: var(--primary); color: white; border: none; padding: 9px; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 0.95em; width: 100%; transition: 0.2s; }
        button:hover { background: var(--primary-hover); }
        button.secondary { background: white; border: 1px solid var(--border); color: var(--text-muted); }
        input, select { width: 100%; padding: 8px 10px; border: 1px solid var(--border); border-radius: 6px; margin-bottom: 10px; }
        
        /* Oefenen Navigatie Styles */
        .nav-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; }
        .nav-card { 
            background: white; border: 1px solid var(--border); border-radius: 12px; padding: 20px; 
            cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 15px; 
        }
        .nav-card:hover { border-color: var(--primary); transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .nav-card-icon { font-size: 1.8em; background: var(--primary-bg); width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 10px; }
        .nav-card-title { font-weight: 700; color: var(--text-main); font-size: 1.05em; }
        .nav-card-subtitle { font-size: 0.85em; color: var(--text-muted); font-weight: 400; margin-top: 2px; }
        
        .breadcrumb { display: flex; gap: 8px; align-items: center; margin-bottom: 20px; font-size: 0.9em; color: var(--text-muted); }
        .breadcrumb span { cursor: pointer; }
        .breadcrumb span:hover { text-decoration: underline; color: var(--primary); }
        .breadcrumb .active { font-weight: 700; color: var(--text-main); cursor: default; text-decoration: none; }

        /* Quiz Styles */
        .quiz-question-card { background: white; padding: 20px; margin-bottom: 15px; border-radius: var(--radius); border: 1px solid var(--border); border-left: 4px solid var(--primary); }
        .quiz-question-card.correct { border-left-color: #166534; background: #f0fdf4; }
        .quiz-question-card.wrong { border-left-color: #991b1b; background: #fef2f2; }
        
        /* Other Pages (simplified for brevity in this view) */
        .page-section { display: none; padding: 30px; max-width: 1200px; margin: 0 auto; width: 100%; }
        .page-section.active { display: block; animation: fade 0.2s; }
        @keyframes fade { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        @media (max-width: 800px) { #app-sidebar { margin-left: -250px; position: fixed; height: 100%; } #app-sidebar.open { margin-left: 0; } }
    </style>
</head>
<body>

    <div id="toast" style="visibility: hidden; min-width: 200px; background-color: #1e293b; color: #fff; text-align: center; border-radius: 8px; padding: 12px; position: fixed; z-index: 2500; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 0.9em;">Melding</div>

    <nav id="app-sidebar">
        <div class="sidebar-header" onclick="navigate('home')">‚ö° Study-Start</div>
        <div class="nav-item" onclick="navigate('planning', this)"><span>üìÖ</span> Planning</div>
        <div class="nav-item" onclick="navigate('cijfers', this)"><span>üìä</span> Cijfers</div>
        <div class="nav-item" onclick="navigate('notities', this)"><span>üìù</span> Notities</div>
        <div class="nav-item active" onclick="navigate('oefenen', this)"><span>üéì</span> Oefenen</div>
        <div class="nav-item" onclick="navigate('timer', this)"><span>‚è±Ô∏è</span> Timer</div>
    </nav>

    <main id="main-content">
        <header>
            <button onclick="document.getElementById('app-sidebar').classList.toggle('open')" style="width:auto; background:transparent; color:#333; font-size:1.5em; padding:0;">‚ò∞</button>
            <div id="page-title">Oefenen</div>
            <div id="user-display-name">Gast</div>
        </header>

        <div id="page-oefenen" class="page-section active">
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div id="practice-breadcrumbs" class="breadcrumb">
                    <span onclick="resetPracticeNav()">Oefenen</span>
                </div>
            </div>

            <div id="step-level" class="nav-grid">
                </div>

            <div id="step-subject" class="nav-grid" style="display: none;"></div>

            <div id="step-chapter" class="nav-grid" style="display: none;"></div>

            <div id="practice-interface" style="display: none;">
                <div id="quiz-start-screen">
                    <div class="card" style="border-left: 4px solid var(--primary); max-width: 600px; margin: 0 auto;">
                        <h2 id="quiz-start-title">Start Toets</h2>
                        <p id="quiz-start-desc" style="color: var(--text-muted); line-height: 1.6; margin-bottom: 20px;">
                            Je staat op het punt een oefentoets te starten.
                        </p>
                        <button onclick="startQuiz()">Start Toets (20 Vragen)</button>
                    </div>
                </div>
                
                <div id="quiz-container" style="display: none; max-width: 800px; margin: 0 auto;">
                    <div id="quiz-questions-list"></div>
                    <button onclick="submitQuiz()" style="margin-top: 20px;">Toets Inleveren</button>
                </div>

                <div id="quiz-results" style="display: none; max-width: 800px; margin: 0 auto;">
                    <div class="card" style="text-align: center;">
                        <h3>Je Resultaat</h3>
                        <div style="font-size: 3em; font-weight: 800; color: var(--primary); margin: 20px 0;" id="quiz-score">?</div>
                        <p id="quiz-message"></p>
                        <button onclick="startQuiz()">Opnieuw Oefenen</button>
                    </div>
                    <h3>Antwoorden & Uitleg</h3>
                    <div id="quiz-review-list"></div>
                </div>
            </div>
        </div>

        <div id="page-home" class="page-section"><h1>Home</h1></div>
        <div id="page-planning" class="page-section"><h1>Planning</h1></div>
        <div id="page-cijfers" class="page-section"><h1>Cijfers</h1></div>
        <div id="page-notities" class="page-section"><h1>Notities</h1></div>
        <div id="page-timer" class="page-section"><h1>Timer</h1></div>

    </main>

    <script>
        // --- 1. FIREBASE CONFIG (Jouw eigen keys blijven hier) ---
        const firebaseConfig = {
          apiKey: "AIzaSyD_Kg4HjgBpG9QqpEuxfBklPL5-34G3RHI",
          authDomain: "study-start-c510c.firebaseapp.com",
          projectId: "study-start-c510c",
          storageBucket: "study-start-c510c.firebasestorage.app",
          messagingSenderId: "960911379164",
          appId: "1:960911379164:web:ad8648cfa2fe65f8620219"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- 2. DATA STRUCTUUR (De "Boom" van Jaren -> Vakken -> Hoofdstukken) ---
        const practiceContent = {
            "Brugklas (1 VMBO/HAVO)": {
                "Wiskunde": ["H1: Getallen", "H2: Meetkunde", "H3: Formules"],
                "Engels": ["Unit 1: Getting Started", "Unit 2: Family", "Grammar: To Be"],
                "Nederlands": ["Spelling: Werkwoorden", "Begrijpend Lezen 1"]
            },
            "Brugklas (1 HAVO/VWO)": {
                "Wiskunde": ["H1: Vlakke Figuren", "H2: Rekenen", "H3: Formules & Grafieken"],
                "Frans": ["Chapitre 1: Bonjour", "Chapitre 2: √âcole"],
                "Geschiedenis": ["Jagers en Boeren", "Grieken en Romeinen"]
            },
            "2 VMBO-T": {
                "Wiskunde": ["H1: Procenten", "H2: Meetkunde"],
                "Economie": ["Geldzaken", "Verzekeren"]
            },
            "2 HAVO": {
                "Wiskunde": ["H1: Lineaire Formules", "H2: Vergelijkingen", "H3: Statistiek"],
                "Natuurkunde": ["Licht en Beeld", "Elektriciteit"]
            },
            "2 VWO": {
                "Wiskunde B": ["H1: Algebra", "H2: Meetkunde Bewijzen"],
                "Latijn": ["Les 1-5 Grammatica", "Mythologie"]
            },
            "3 HAVO": {
                "Wiskunde A": ["H1: Tabellen", "H2: Vergelijkingen"],
                "Wiskunde B": ["H1: Functies", "H2: Goniometrie"],
                "Scheikunde": ["Stoffen en Reacties", "Moleculen"]
            },
            "Eindexamenjaar (4 VMBO)": {
                "Wiskunde": ["Examentraining: Algebra", "Examentraining: Meetkunde"],
                "Engels": ["Leesvaardigheid", "Vocabulaire"]
            },
            "Eindexamenjaar (5 HAVO)": {
                "Wiskunde A": ["Kansberekening", "Statistiek"],
                "Economie": ["Vraag en Aanbod", "Markten"]
            }
        };

        // State variabelen
        let currentLevel = null;
        let currentSubject = null;
        let currentChapter = null;

        // --- 3. NAVIGATIE LOGICA ---

        // Start de app (wordt aangeroepen bij laden)
        function initApp() {
            resetPracticeNav();
            navigate('oefenen');
        }

        // Navigatie tussen pagina's (Home, Planning, etc.)
        function navigate(pageId, el) {
            document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(el) el.classList.add('active');
            
            document.getElementById('page-title').innerText = pageId.charAt(0).toUpperCase() + pageId.slice(1);
        }

        // Functie om terug te gaan naar het begin van oefenen
        function resetPracticeNav() {
            currentLevel = null; currentSubject = null; currentChapter = null;
            document.getElementById('step-level').style.display = 'grid';
            document.getElementById('step-subject').style.display = 'none';
            document.getElementById('step-chapter').style.display = 'none';
            document.getElementById('practice-interface').style.display = 'none';
            
            renderLevels();
            updateBreadcrumbs([]);
        }

        // Stap 1: Toon alle Jaren/Niveaus
        function renderLevels() {
            const container = document.getElementById('step-level');
            container.innerHTML = '';
            
            Object.keys(practiceContent).forEach(level => {
                container.innerHTML += `
                <div class="nav-card" onclick="selectLevel('${level}')">
                    <div class="nav-card-icon">üìö</div>
                    <div>
                        <div class="nav-card-title">${level}</div>
                        <div class="nav-card-subtitle">${Object.keys(practiceContent[level]).length} Vakken</div>
                    </div>
                </div>`;
            });
        }

        function selectLevel(level) {
            currentLevel = level;
            document.getElementById('step-level').style.display = 'none';
            document.getElementById('step-subject').style.display = 'grid';
            renderSubjects(level);
            updateBreadcrumbs([level]);
        }

        // Stap 2: Toon Vakken van gekozen niveau
        function renderSubjects(level) {
            const container = document.getElementById('step-subject');
            container.innerHTML = '';
            const subjects = practiceContent[level];
            
            Object.keys(subjects).forEach(subject => {
                // Icoontjes op basis van vaknaam
                let icon = 'üìñ';
                if(subject.includes('Wiskunde')) icon = 'üìê';
                if(subject.includes('Engels') || subject.includes('Frans')) icon = 'üó£Ô∏è';
                if(subject.includes('Geschiedenis')) icon = 'üèõÔ∏è';
                if(subject.includes('Natuur') || subject.includes('Schei')) icon = 'üß™';
                if(subject.includes('Economie')) icon = 'üí∞';

                container.innerHTML += `
                <div class="nav-card" onclick="selectSubject('${subject}')">
                    <div class="nav-card-icon">${icon}</div>
                    <div>
                        <div class="nav-card-title">${subject}</div>
                        <div class="nav-card-subtitle">${subjects[subject].length} Onderwerpen</div>
                    </div>
                </div>`;
            });
        }

        function selectSubject(subject) {
            currentSubject = subject;
            document.getElementById('step-subject').style.display = 'none';
            document.getElementById('step-chapter').style.display = 'grid';
            renderChapters(currentLevel, subject);
            updateBreadcrumbs([currentLevel, subject]);
        }

        // Stap 3: Toon Hoofdstukken
        function renderChapters(level, subject) {
            const container = document.getElementById('step-chapter');
            container.innerHTML = '';
            const chapters = practiceContent[level][subject];
            
            chapters.forEach(chapter => {
                container.innerHTML += `
                <div class="nav-card" onclick="selectChapter('${chapter}')">
                    <div class="nav-card-icon">üìù</div>
                    <div>
                        <div class="nav-card-title">${chapter}</div>
                        <div class="nav-card-subtitle">Klik om te starten</div>
                    </div>
                </div>`;
            });
        }

        function selectChapter(chapter) {
            currentChapter = chapter;
            document.getElementById('step-chapter').style.display = 'none';
            document.getElementById('practice-interface').style.display = 'block';
            updateBreadcrumbs([currentLevel, currentSubject, currentChapter]);
            
            // UI Update
            document.getElementById('quiz-start-title').innerText = `${currentSubject}: ${chapter}`;
            document.getElementById('quiz-start-screen').style.display = 'block';
            document.getElementById('quiz-container').style.display = 'none';
            document.getElementById('quiz-results').style.display = 'none';
        }

        // Update de tekst bovenin (Broodkruimelpad)
        function updateBreadcrumbs(path) {
            const bc = document.getElementById('practice-breadcrumbs');
            let html = `<span onclick="resetPracticeNav()">Alle Jaren</span>`;
            
            if(path.length > 0) html += ` > <span onclick="selectLevel('${path[0]}')">${path[0]}</span>`;
            if(path.length > 1) html += ` > <span onclick="selectSubject('${path[1]}')">${path[1]}</span>`;
            if(path.length > 2) html += ` > <span class="active">${path[2]}</span>`;
            
            bc.innerHTML = html;
        }

        // --- 4. OEFENTOETS SYSTEEM (Gesimuleerd) ---
        let currentQuizQuestions = [];
        
        // Simpele Wiskunde generator (zodat de toetsen ook echt werken voor de demo)
        const mathQuestionsBank = [
            {q:"Los op: 2x = 10", a:5, h:"Deel 10 door 2."},
            {q:"Los op: x + 5 = 12", a:7, h:"12 min 5 is 7."},
            {q:"Bereken: 5¬≤", a:25, h:"5 keer 5."},
            {q:"Los op: 3x - 2 = 13", a:5, h:"3x = 15, dus x = 5."},
            {q:"Wat is 10% van 200?", a:20, h:"Deel 200 door 10."}
        ];

        function startQuiz() {
            document.getElementById('quiz-start-screen').style.display = 'none';
            document.getElementById('quiz-results').style.display = 'none';
            document.getElementById('quiz-container').style.display = 'block';

            // Hier simuleren we het ophalen van vragen. 
            // In de toekomst vervang je dit door een call naar Firebase op basis van 'currentChapter'.
            const list = document.getElementById('quiz-questions-list');
            list.innerHTML = '';
            
            // Genereer 5 random vragen voor de demo (of gebruik echte als het wiskunde is)
            currentQuizQuestions = [];
            
            if(currentSubject.includes('Wiskunde')) {
                // Pak wiskunde vragen
                for(let i=0; i<5; i++) {
                    // Random vraag uit de bank of genereer som
                    const num1 = Math.floor(Math.random() * 10) + 1;
                    const num2 = Math.floor(Math.random() * 10) + 1;
                    currentQuizQuestions.push({
                        q: `Bereken: ${num1} x ${num2}`,
                        a: num1 * num2,
                        h: "Tafel van vermenigvuldiging."
                    });
                }
            } else {
                // Placeholder vragen voor andere vakken
                for(let i=1; i<=5; i++) {
                    currentQuizQuestions.push({
                        q: `Vraag ${i} over ${currentChapter}`,
                        a: 10,
                        h: "Dit is een demo vraag."
                    });
                }
            }

            // Render Vragen
            currentQuizQuestions.forEach((item, index) => {
                list.innerHTML += `
                <div class="quiz-question-card" id="q-card-${index}">
                    <div style="font-weight:600; margin-bottom:10px;">Vraag ${index+1}</div>
                    <div style="font-size:1.2em; margin-bottom:10px;">${item.q}</div>
                    <input type="number" class="quiz-input" id="q-input-${index}" placeholder="Antwoord...">
                    <div class="quiz-feedback" id="q-feedback-${index}" style="display:none; margin-top:10px; color:#64748b; border-top:1px dashed #eee; padding-top:5px;"></div>
                </div>`;
            });
        }

        function submitQuiz() {
            let score = 0;
            currentQuizQuestions.forEach((item, index) => {
                const input = document.getElementById(`q-input-${index}`);
                const card = document.getElementById(`q-card-${index}`);
                const feedback = document.getElementById(`q-feedback-${index}`);
                const val = parseFloat(input.value);
                
                feedback.style.display = 'block';
                input.disabled = true;

                if (val === item.a) {
                    score++;
                    card.classList.add('correct');
                    feedback.innerHTML = `‚úÖ Correct!`;
                } else {
                    card.classList.add('wrong');
                    feedback.innerHTML = `‚ùå Fout. Antwoord: <b>${item.a}</b>. <br>Tip: ${item.h}`;
                }
            });

            // Score berekening
            const grade = Math.round(((score / currentQuizQuestions.length) * 9 + 1) * 10) / 10;
            
            document.getElementById('quiz-container').style.display = 'none';
            document.getElementById('quiz-results').style.display = 'block';
            document.getElementById('quiz-score').innerText = grade;
            document.getElementById('quiz-message').innerText = `Je had ${score} van de ${currentQuizQuestions.length} goed.`;
            
            // Kopieer vragen naar resultaat scherm om terug te kijken
            document.getElementById('quiz-review-list').innerHTML = document.getElementById('quiz-questions-list').innerHTML;
            
            window.scrollTo(0,0);
        }

        // Init App bij laden
        window.onload = initApp;

    </script>
</body>
</html>
